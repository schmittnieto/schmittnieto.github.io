<!-- === Head: defaults de consentimiento y carga temprana de Clarity en modo restringido === -->
<script>
  // dataLayer + gtag bootstrap
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }

  // Google Consent Mode v2: por defecto todo denegado
  gtag('consent', 'default', {
    ad_storage: 'denied',
    analytics_storage: 'denied',
    ad_user_data: 'denied',
    ad_personalization: 'denied'
  });

  // Stub de Clarity + se√±al de no consentimiento por defecto
  window.clarity = window.clarity || function(){ (window.clarity.q = window.clarity.q || []).push(arguments); };
  window.clarity('consentv2', { ad_Storage: 'denied', analytics_Storage: 'denied' });

  // Carga SIEMPRE el tag de Clarity; operar√° sin cookies mientras no haya consentimiento
  (function loadClarityEarly(){
    if (document.getElementById('clarity-loader')) return;
    var sCl = document.createElement('script');
    sCl.id = 'clarity-loader';
    sCl.async = true;
    sCl.src = 'https://www.clarity.ms/tag/odc6tt5gf3';
    document.head.appendChild(sCl);
  })();
</script>

<style>
  /* Tu CSS original‚Ä¶ */
  #cookie-notice{font-weight:900;font-size:1rem;padding:.5rem 1rem;display:none;text-align:center;position:fixed;bottom:0;left:0;width:100%;background:#222;color:rgba(255,255,255,.8);z-index:9000;border-top:2px solid #00a8ff;box-shadow:0 -3px 5px rgba(0,0,0,.3)}
  #cookie-notice a{color:#00a8ff;margin-left:1rem;font-weight:600}
  #cookie-notice .btn{background-color:#00a8ff;border:none;color:#fff;padding:.5rem 1rem;text-transform:uppercase;cursor:pointer;margin-left:1rem;border-radius:4px}
  #cookie-notice .btn:hover{background-color:#0073b1}
  @media (max-width:767px){#cookie-notice{padding:1rem}#cookie-notice span{display:block;margin-bottom:10px}#cookie-notice .btn{display:inline-block;margin:5px 0}}
  #cookie-toggle{position:fixed;bottom:20px;right:15px;font-size:32px;cursor:pointer;z-index:9001;display:none;background:none;border:none}
</style>

<!-- Banner -->
<div id="cookie-notice">
  <span>We use cookies to enhance your experience. <a href="/privacy-policy/">Privacy Policy</a></span>
  <a id="cookie-notice-accept" class="btn btn-primary btn-sm">Accept</a>
  <a id="cookie-notice-decline" class="btn btn-primary btn-sm">Decline</a>
</div>
<button id="cookie-toggle">üç™</button>

<script>
  // --- Utils cookies ---
  function createCookie(name, value, days){
    var expires = "";
    if (days){
      var d = new Date();
      d.setTime(d.getTime() + (days*24*60*60*1000));
      expires = "; expires=" + d.toUTCString();
    }
    document.cookie = name + "=" + value + expires + "; path=/; SameSite=Lax";
  }
  function readCookie(name){
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for (var i=0; i<ca.length; i++){
      var c = ca[i];
      while (c.charAt(0) == ' ') c = c.substring(1,c.length);
      if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
  }

  // --- GA4 solo tras consentimiento ---
  function loadGA(){
    if (document.getElementById('ga4-loader')) return;
    var sGA = document.createElement('script');
    sGA.id = 'ga4-loader';
    sGA.src = 'https://www.googletagmanager.com/gtag/js?id=G-0JC8WREF2K';
    sGA.async = true;
    document.head.appendChild(sGA);
    sGA.onload = function(){
      gtag('js', new Date());
      gtag('config', 'G-0JC8WREF2K');
    };
  }

  // --- Se√±ales de consentimiento ---
  function grantConsent(){
    // Google Consent Mode v2
    gtag('consent', 'update', {
      ad_storage: 'granted',
      analytics_storage: 'granted',
      ad_user_data: 'granted',
      ad_personalization: 'granted'
    });
    // Clarity: pasa a modo con cookies y sesi√≥n normal
    window.clarity('consentv2', { ad_Storage: 'granted', analytics_Storage: 'granted' });
  }
  function denyConsent(){
    gtag('consent', 'update', {
      ad_storage: 'denied',
      analytics_storage: 'denied',
      ad_user_data: 'denied',
      ad_personalization: 'denied'
    });
    window.clarity('consentv2', { ad_Storage: 'denied', analytics_Storage: 'denied' });
  }

  // --- Estado inicial UI ---
  (function init(){
    var choice = readCookie('cookie-notice-dismissed');
    var banner = document.getElementById('cookie-notice');
    var toggle = document.getElementById('cookie-toggle');

    if (choice === 'true'){
      toggle.style.display = 'block';
      grantConsent();
      loadGA();
    } else if (choice === 'false'){
      toggle.style.display = 'block';
      denyConsent();
      banner.style.display = 'block'; // o 'none' si no quieres re-pedir
    } else {
      banner.style.display = 'block';
    }
  })();

  // --- Eventos ---
  document.getElementById('cookie-notice-accept').addEventListener('click', function(){
    createCookie('cookie-notice-dismissed', 'true', 31);
    document.getElementById('cookie-notice').style.display = 'none';
    document.getElementById('cookie-toggle').style.display = 'block';
    grantConsent();
    loadGA();
  });

  document.getElementById('cookie-notice-decline').addEventListener('click', function(){
    var wasTrue = readCookie('cookie-notice-dismissed') === 'true';
    createCookie('cookie-notice-dismissed', 'false', 31);
    document.getElementById('cookie-notice').style.display = 'none';
    document.getElementById('cookie-toggle').style.display = 'block';
    denyConsent();
    // Si el usuario revoca desde aceptado a denegado, puedes recargar:
    // if (wasTrue) location.reload();
  });

  document.getElementById('cookie-toggle').addEventListener('click', function(){
    document.getElementById('cookie-notice').style.display = 'block';
    document.getElementById('cookie-toggle').style.display = 'none';
  });
</script>
