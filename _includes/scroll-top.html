<!-- Scroll to Top Button -->
<style>
    /* Scroll to Top Button Styles */
    #scroll-top-btn {
        display: none; /* Hidden by default */
        position: fixed;
        top: 20px; /* Position at the top */
        right: 20px; /* Position at the right */
        z-index: 9002; /* Ensure it sits above other elements */
        background: rgba(255, 255, 255, 0.6); /* More opaque semi-transparent background */
        border: 2px solid white; /* White border for visibility */
        border-radius: 8px; /* Slightly rounded corners */
        font-size: 36px; /* Same size as the cookie consent emoji */
        cursor: pointer;
        transition: opacity 0.5s ease, visibility 0.5s ease;
        padding: 0.5rem; /* Adequate padding for touch devices */
        /* Optional: Add shadow for better visibility */
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        /* Ensure the button is focusable */
        outline: none;
    }

    #scroll-top-btn:hover,
    #scroll-top-btn:focus {
        opacity: 0.8;
    }
</style>

<!-- Scroll to Top Button HTML -->
<button id="scroll-top-btn" title="Go to top" aria-label="Scroll to top">
    üîù
</button>

<!-- Scroll to Top Button Script -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const scrollBtn = document.getElementById("scroll-top-btn");
        let scrollTimeout;
        let isButtonClicked = false; // Flag to track if button was clicked

        /**
         * Function to show the scroll button.
         * This function is called on any scroll event, regardless of direction.
         */
        function showScrollBtn() {
            if (window.innerWidth <= 767) { // Ensure it's a mobile device
                if (window.scrollY > 0) { // Trigger as soon as scrolling starts
                    if (scrollBtn.style.display !== "block" && !isButtonClicked) {
                        scrollBtn.style.display = "block";
                        // Allow time for display to take effect before starting transition
                        setTimeout(() => {
                            scrollBtn.style.opacity = "1";
                            scrollBtn.style.visibility = "visible";
                        }, 10);
                    }

                    // Reset the hide timer only if the button wasn't clicked
                    if (!isButtonClicked) {
                        clearTimeout(scrollTimeout);
                        scrollTimeout = setTimeout(() => {
                            // Start fade-out effect
                            scrollBtn.style.opacity = "0";
                            scrollBtn.style.visibility = "hidden";
                            // Hide the button after the transition duration
                            setTimeout(() => {
                                scrollBtn.style.display = "none";
                            }, 500); // Match the CSS transition duration
                        }, 1500); // Visibility duration set to 1.5 seconds
                    }
                }
            }
        }

        /**
         * Function to handle scroll events.
         * Shows the button on any scroll (up or down).
         */
        function handleScroll() {
            showScrollBtn();
        }

        // Attach the scroll event listener without debounce for instant response
        window.addEventListener("scroll", handleScroll);

        // When the user clicks on the button, scroll to the top smoothly and hide the button
        scrollBtn.addEventListener("click", function () {
            isButtonClicked = true; // Set flag to prevent reappearing during scroll up
            window.scrollTo({
                top: 0,
                behavior: "smooth"
            });
            // Hide the button immediately after click
            scrollBtn.style.opacity = "0";
            scrollBtn.style.visibility = "hidden";
            setTimeout(() => {
                scrollBtn.style.display = "none";
                isButtonClicked = false; // Reset flag after hiding
            }, 500); // Match the CSS transition duration
            // Clear any existing hide timers to prevent conflicts
            clearTimeout(scrollTimeout);
        });

        // Handle window resize to hide the button if not on mobile
        window.addEventListener("resize", function () {
            if (window.innerWidth > 767) {
                clearTimeout(scrollTimeout);
                scrollBtn.style.display = "none";
                scrollBtn.style.opacity = "0";
                scrollBtn.style.visibility = "hidden";
                isButtonClicked = false; // Reset flag on resize
            }
        });

        // Ensure the button is hidden on initial load if not scrolled
        if (window.innerWidth > 767 || window.scrollY <= 0) { // Adjusted threshold to 0
            scrollBtn.style.display = "none";
            scrollBtn.style.opacity = "0";
            scrollBtn.style.visibility = "hidden";
        }
    });
</script>